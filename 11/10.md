
Task

    通过执行以下任务在集群中安装 ArgoCD：   
    添加 ArgoCD Helm 仓库：`helm repo add argo https://argoproj.github.io/argo-helm`   名为 argo


    > argo CD CRD 已经在集群中预安装

为 argocd namespace 生成 argo CD helm 图标版本 7.7.3 的模版 ，并将其保存到 /home/candidate/argo-helm.yaml,  将图标配置为不安装crd

使用helm 安装 argo cd 并设置发布名称为 argocd , 使用与模版相同的版本和配置 （7.7.3） 将其安装在 argocd 命名空间中c  并配置为 不安装crds 
 



 根据您的要求，在集群中安装ArgoCD并正确配置，需要完成添加Helm仓库、生成模板和安装三个主要步骤。以下是详细的操作指南。

### 🛠️ 安装ArgoCD的详细步骤

#### 1. 添加ArgoCD Helm仓库
首先，将ArgoCD的官方Helm仓库添加到您的本地环境中。
```bash
helm repo add argo https://argoproj.github.io/argo-helm
```
添加成功后，建议更新仓库索引以确保获取到最新的图表信息。
```bash
helm repo update
```
您可以通过以下命令验证仓库是否添加成功：
```bash
helm repo list | grep argo
```

#### 2. 生成Helm模板并保存
由于集群已预装ArgoCD CRD，生成模板时必须禁用CRD安装以避免冲突。
```bash
helm template argocd argo/argo-cd \
  --version 7.7.3 \
  --namespace argocd \
  --create-namespace \
  --set installCRDs=false \
  > /home/candidate/argo-helm.yaml
```
**关键参数说明**：
*   `helm template argocd argo/argo-cd`: 为名为`argo-cd`的Chart生成模板，发布名称设为`argocd`。
*   `--version 7.7.3`: 指定安装的Chart版本。
*   `--namespace argocd`: 指定资源部署的命名空间。
*   `--create-namespace`: 如果命名空间不存在则自动创建。
*   `--set installCRDs=false`: **核心配置**，禁止安装CRD。
*   `> /home/candidate/argo-helm.yaml`: 将生成的YAML输出到指定文件。

#### 3. 安装ArgoCD
使用与模板生成相同的配置来安装ArgoCD，确保实际部署与预览一致。
```bash
helm install argocd argo/argo-cd \
  --version 7.7.3 \
  --namespace argocd \
  --create-namespace \
  --set installCRDs=false
```

### 🔍 验证安装
安装完成后，建议进行以下检查以确保ArgoCD组件正常运行：

1.  **检查Helm发布状态**：
    ```bash
    helm list -n argocd
    ```
    如果`STATUS`列显示为`deployed`，则表示安装成功。

2.  **查看Pod状态**：
    ```bash
    kubectl get pods -n argocd
    ```
    请等待所有Pod的状态变为`Running`。

### 💎 重要提示
*   **禁用CRD安装是关键**：因为您的集群已预装ArgoCD CRD，所以必须通过`--set installCRDs=false`参数禁止Helm再次安装。忽略此步骤可能导致CRD版本冲突或安装失败。
*   **版本一致性**：确保模板生成和实际安装时使用的Chart版本一致（此处为`7.7.3`），以避免配置差异。

希望以上步骤能帮助您顺利完成ArgoCD的安装。如果在安装过程中遇到问题，或者想了解更多关于配置ArgoCD的信息，请随时告诉我。